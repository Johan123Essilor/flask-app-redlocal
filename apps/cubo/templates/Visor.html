<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>3D Box Viewer</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/estilo3D.css') }}">
  <style>
    /* Opcional: Ocultar cubo vacío para que no ocupe espacio */
    #cube:empty {
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>{{ cliente.name }} </h1>
    
    <nav id="cubeSelector"></nav>
  </header>
  <div id="btnSelected"></div>
  <main>
    <div class="container" id="cube"></div>
  </main>

  <script>
    // Nota: Ya no inicializamos btnValue ni setCube automáticamente

    const clienteData = {{ cliente | tojson }};
    const cube = document.getElementById('cube');
    const nav = document.getElementById('cubeSelector');
    let isDragging = false;
    let prevX, prevY;
    let rotX = -10, rotY = 20;

    const cubesData = {
      cube1: { w: 100, h: 150, d: 75, zli:38, zld:63, zts: 38, zti: 113, color: '#C2A073', label: 'FS' },
      cube2: { w: 200, h: 100, d: 133, zli:67, zld:133, zts: 67, zti: 33, zf:0,color: '#C2A073', label: 'DS' },
      cube3: { w: 200, h: 150, d: 150, zli:75, zld:125, zts: 75, zti: 75, color: '#C2A073', label: 'A' },
      cube4: { w: 300, h: 150, d: 225, zli:113, zld:188, zts: 113, zti: 38, color: '#C2A073', label: 'B' },
      cube5: { w: 400, h: 150, d: 260, zli:130, zld:270, zts: 130, zti: 20, color: '#C2A073', label: 'C' },
      cube6: { w: 400, h: 275, d: 240, zli:120, zld:280, zts: 120, zti: 155, color: '#C2A073', label: 'D' },
      cube7: { w: 400, h: 300, d: 260, zli:130, zld:270, zts: 130, zti: 170, color: '#C2A073', label: 'D2' },
      cube8: { w: 400, h: 300, d: 300, zli:150, zld:250, zts: 150, zti: 150, color: '#C2A073', label: 'F' }
    };

    function createNav() {
      for (const key in cubesData) {
        const btn = document.createElement('button');
        btn.textContent = cubesData[key].label;
        btn.dataset.cube = key;

        btn.addEventListener('click', () => {
          document.getElementById("btnSelected").textContent = cubesData[key].label;
          btnValue = cubesData[key].label;
          setActiveButton(btn);
          setCube(key);
        });

        nav.appendChild(btn);
      }
    }

    function setActiveButton(activeBtn) {
      [...nav.children].forEach(btn => btn.classList.remove('active'));
      activeBtn.classList.add('active');
    }

    function setCube(name) {
      const { w, h, d, zli, zld, zts, zti, color } = cubesData[name];
      cube.style.width = w + 'px';
      cube.style.height = h + 'px';

      cube.innerHTML = `
        <div class="face front" style="width:${w}px; height:${h}px; transform: translateZ(${d/2}px); background-color: ${color};font-size: 12px;">${btnValue}</div>
        <div class="face back" style="width:${w}px; height:${h}px; transform: rotateY(180deg) translateZ(${d / 2}px); background-color: ${color};font-size: 12px;">Posterior</div>
        <div class="face right" style="width:${d}px; height:${h}px; transform: rotateY(90deg) translateZ(${zld}px); background-color: ${color};font-size: 12px;">Derecha</div>
        <div class="face left" style="width:${d}px; height:${h}px; transform: rotateY(-90deg) translateZ(${zli}px); background-color: ${color};font-size: 12px;">Izquierda</div>
        <div class="face top" style="width:${w}px; height:${d}px; transform: rotateX(90deg) translateZ(${zts}px); background-color: ${color};font-size: 12px;">Superior</div>
        <div class="face bottom" style="width:${w}px; height:${d}px; transform: rotateX(-90deg) translateZ(${zti}px); background-color: ${color};font-size: 12px;">Inferior</div>
      `;

      rotX = -10; rotY = 20;
      cube.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;

      // Agrega caras extra
      addExtraFaceUCC({
        reference: clienteData[btnValue].UCCface,
        offset: clienteData[btnValue].UCCoffset,
        width: clienteData[btnValue].UCCetiquetaWidth,
        height: clienteData[btnValue].UCCetiquetaHeight,
        cubeData: cubesData[name],
        x: clienteData[btnValue].UCCX,
        y: clienteData[btnValue].UCCY
      });

      addExtraFace({
        reference: clienteData[btnValue].face,
        offset: clienteData[btnValue].offset,
        width: clienteData[btnValue].etiquetaWidth,
        height: clienteData[btnValue].etiquetaHeight,
        cubeData: cubesData[name],
        x: clienteData[btnValue].X,
        y: clienteData[btnValue].Y
      });

      addExtraFace2({
        reference: clienteData[btnValue].face2,
        offset: clienteData[btnValue].offset2,
        width: clienteData[btnValue].etiquetaWidth2,
        height: clienteData[btnValue].etiquetaHeight2,
        cubeData: cubesData[name],
        x: clienteData[btnValue].X2,
        y: clienteData[btnValue].Y2
      });
    }

    // (Las funciones addExtraFaceUCC, addExtraFace, addExtraFace2 quedan igual)

    function addExtraFaceUCC({ reference, offset, width, height, cubeData,x, y}) {
      const { w, h, d } = cubeData;

      const extra = document.createElement('div');
      extra.className = 'face';
      extra.style.background = 'white';
      extra.style.opacity = 0.9;
      extra.style.width = `${width}px`;
      extra.style.height = `${height}px`;
      extra.textContent = 'UCC';

      let transform = '';

      switch (reference) {
        case 'front':
          transform = `translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'back':
          transform = `rotateY(180deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'right':
          transform = `rotateY(90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'left':
          transform = `rotateY(-90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'top':
          transform = `rotateX(90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'bottom':
          transform = `rotateX(-90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        default:
          console.warn('Referencia no válida');
          return;
      }

      extra.style.transform = transform;
      cube.appendChild(extra);
    }

    function addExtraFace({ reference, offset, width, height, cubeData,x, y}) {
      const { w, h, d } = cubeData;

      const extra = document.createElement('div');
      extra.className = 'face';
      extra.style.background = 'white';
      extra.style.opacity = 0.9;
      extra.style.width = `${width}px`;
      extra.style.height = `${height}px`;
      extra.textContent = 'Etiqueta';

      let transform = '';

      switch (reference) {
        case 'front':
          transform = `translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'back':
          transform = `rotateY(180deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'right':
          transform = `rotateY(90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'left':
          transform = `rotateY(-90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'top':
          transform = `rotateX(90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'bottom':
          transform = `rotateX(-90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        default:
          console.warn('Referencia no válida');
          return;
      }

      extra.style.transform = transform;
      cube.appendChild(extra);
    }

    function addExtraFace2({ reference, offset, width, height, cubeData,x, y}) {
      const { w, h, d } = cubeData;

      const extra = document.createElement('div');
      extra.className = 'face';
      extra.style.background = 'white';
      extra.style.opacity = 0.9;
      extra.style.width = `${width}px`;
      extra.style.height = `${height}px`;
      extra.textContent = 'Etiqueta2';

      let transform = '';

      switch (reference) {
        case 'front':
          transform = `translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'back':
          transform = `rotateY(180deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'right':
          transform = `rotateY(90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'left':
          transform = `rotateY(-90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'top':
          transform = `rotateX(90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        case 'bottom':
          transform = `rotateX(-90deg) translateZ(${d / 2 + offset}px) translateX(${x}px) translateY(${y}px)`;
          break;
        default:
          console.warn('Referencia no válida');
          return;
      }

      extra.style.transform = transform;
      cube.appendChild(extra);
    }

    function handleMouseDown(e) {
      isDragging = true;
      prevX = e.clientX;
      prevY = e.clientY;
    }

    function handleMouseUp(e) {
      isDragging = false;
    }

    function handleMouseMove(e) {
      if (!isDragging) return;

      const dx = e.clientX - prevX;
      const dy = e.clientY - prevY;

      rotX -= dy * 0.5;
      rotY += dx * 0.5;

      cube.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;

      prevX = e.clientX;
      prevY = e.clientY;
    }

    // Agrega los botones pero no crea ningún cubo al cargar
    createNav();

    // Eventos para rotar
    cube.addEventListener('mousedown', handleMouseDown);
    window.addEventListener('mouseup', handleMouseUp);
    window.addEventListener('mousemove', handleMouseMove);
  </script>
</body>
</html>
