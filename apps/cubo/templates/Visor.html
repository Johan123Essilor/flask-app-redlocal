<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Cajas 3D Interactivas</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/estilo3D.css') }}">
  <style>
 
  </style>
</head>
<body>
  <header>
    <h1>{{ cliente.name }}</h1>
    <nav id="cubeSelector"></nav>
  </header>

  <main>
    <div class="container" id="cube"></div>
  </main>

  <script>
     const clienteData = {{ cliente | tojson }};
    const cube = document.getElementById('cube');
    const nav = document.getElementById('cubeSelector');

    let isDragging = false;
    let prevX, prevY;
    let rotX = -10, rotY = 20;

    // Definimos 6 cubos con diferentes dimensiones y colores
    const cubesData = {
      cube1: { w: 200, h: 100, d: 100, zli:50, zld:150, zts: 50, zti: 50, zf:0,color: '#C2A073', label: 'Caja Pequeña' },
      cube2: { w: 300, h: 200, d: 150, zli:75, zld:225, zts: 75, zti: 125, color: '#C2A073', label: 'Caja Mediana' },
      cube3: { w: 500, h: 300, d: 300, zli:75, zld:225, zts: 75, zti: 125, color: '#C2A073', label: 'Caja Grande' },
      cube4: { w: 250, h: 250, d: 250, zli:75, zld:225, zts: 75, zti: 125, color: '#C2A073', label: 'Caja Cuadrada' },
      cube5: { w: 350, h: 150, d: 200, zli:75, zld:225, zts: 75, zti: 125, color: '#C2A073', label: 'Caja Apilable' },
      cube6: { w: 150, h: 400, d: 100, zli:75, zld:225, zts: 75, zti: 125, color: '#C2A073', label: 'Caja Alta' }
    };

    // Función para crear el nav dinámico
    function createNav() {
      for (const key in cubesData) {
        const btn = document.createElement('button');
        btn.textContent = cubesData[key].label;
        btn.dataset.cube = key;
        btn.addEventListener('click', () => {
          setActiveButton(btn);
          setCube(key);
        });
        nav.appendChild(btn);
      }
    }

    function setActiveButton(activeBtn) {
      // Remueve clase active de todos y la agrega sólo al seleccionado
      [...nav.children].forEach(btn => btn.classList.remove('active'));
      activeBtn.classList.add('active');
    }

    // Construye el cubo basado en el nombre de cubo
    function setCube(name) {
      const { w, h, d, zli, zld, zts, zti, color } = cubesData[name];
      cube.style.width = w + 'px';
      cube.style.height = h + 'px';

      cube.innerHTML = `
        <div class="face front" style="width:${w}px; height:${h}px; transform: translateZ(${d/2}px); background-color: ${color};">Frontal</div>
        <div class="face back" style="width:${w}px; height:${h}px; transform: rotateY(180deg) translateZ(${d / 2}px); background-color: ${color};">Posterior</div>
        <div class="face right" style="width:${d}px; height:${h}px; transform: rotateY(90deg) translateZ(${zld}px); background-color: ${color};">Derecha</div>
        <div class="face left" style="width:${d}px; height:${h}px; transform: rotateY(-90deg) translateZ(${zli}px); background-color: ${color};">Izquierda</div>
        <div class="face top" style="width:${w}px; height:${d}px; transform: rotateX(90deg) translateZ(${zts}px); background-color: ${color};">Superior</div>
        <div class="face bottom" style="width:${w}px; height:${d}px; transform: rotateX(-90deg) translateZ(${zti}px); background-color: ${color};">Inferior</div>
      `;

        // Resetea rotación al cambiar cubo
        rotX = -10; rotY = 20;
        cube.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;

        // Agrega cara extra (opcional)
        addExtraFaceUCC({ reference: 'front', offset: 20, width: clienteData.etiquetaWidth, height: 100, cubeData: cubesData[name] });


      
    }
    function addExtraFaceUCC({ reference = 'front', offset = 20, width = 100, height = 100, cubeData }) {
  const { w, h, d } = cubeData;

  const extra = document.createElement('div');
  extra.className = 'face';
  extra.style.background = 'white';
  extra.style.opacity = 0.9;
  extra.style.width = `${width}px`;
  extra.style.height = `${height}px`;
  extra.textContent = 'Extra';

  let transform = '';

  switch (reference) {
    case 'front':
      transform = `translateZ(${d / 2 + offset}px)`;
      break;
    case 'back':
      transform = `rotateY(180deg) translateZ(${d / 2 + offset}px)`;
      break;
    case 'right':
      transform = `rotateY(90deg) translateZ(${w / 2 + offset}px)`;
      break;
    case 'left':
      transform = `rotateY(-90deg) translateZ(${w / 2 + offset}px)`;
      break;
    case 'top':
      transform = `rotateX(90deg) translateZ(${h / 2 + offset}px)`;
      break;
    case 'bottom':
      transform = `rotateX(-90deg) translateZ(${h / 2 + offset}px)`;
      break;
    default:
      console.warn('Referencia no válida');
      return;
  }

  extra.style.transform = transform;
  cube.appendChild(extra);
}

    // Drag y touch para rotar cubo
    function getTouchPos(e) {
      const touch = e.touches[0];
      return { x: touch.clientX, y: touch.clientY };
    }

    document.addEventListener('mousedown', e => {
      if (e.target.closest('#cube')) {
        isDragging = true;
        prevX = e.clientX;
        prevY = e.clientY;
        cube.style.cursor = 'grabbing';
      }
    });

    document.addEventListener('mouseup', () => {
      isDragging = false;
      cube.style.cursor = 'grab';
    });

    document.addEventListener('mousemove', e => {
      if (!isDragging) return;
      const dx = e.clientX - prevX;
      const dy = e.clientY - prevY;
      prevX = e.clientX;
      prevY = e.clientY;
      rotY += dx * 0.4;
      rotX -= dy * 0.4;
      cube.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
    });

    document.addEventListener('touchstart', e => {
      if (e.target.closest('#cube')) {
        isDragging = true;
        const pos = getTouchPos(e);
        prevX = pos.x;
        prevY = pos.y;
      }
    });

    document.addEventListener('touchend', () => {
      isDragging = false;
    });

    document.addEventListener('touchmove', e => {
      if (!isDragging) return;
      e.preventDefault();
      const pos = getTouchPos(e);
      const dx = pos.x - prevX;
      const dy = pos.y - prevY;
      prevX = pos.x;
      prevY = pos.y;
      rotY += dx * 0.4;
      rotX -= dy * 0.4;
      cube.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
    }, { passive: false });

    // Inicializamos nav y cubo por defecto
    createNav();
    // Seleccionar el primer cubo por defecto y activar botón
    nav.children[0].classList.add('active');
    setCube(Object.keys(cubesData)[0]);
  </script>
</body>
</html>
